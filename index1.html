<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="index.css" />
  </head>
  <body>
    <script src="textArea.js"></script>
    <script src="cursor.js"></script>

    <canvas
      id="canvas_id"
      width="220"
      height="240"
      style="border: 1px solid #550233"
      ;
    ></canvas>

    <button id="button2" onclick="backspaceFormerCharacter()">
      Back Space
    </button>
    <button id="button3" onclick="deleteIt()">Delete</button>
    <button id="button4" onclick="Cursor.cursorRight()">Cursor Right</button>
    <button id="button5" onclick="Cursor.cursorLeft()">Cursor Left</button>
    <button id="button6" onclick="TextArea.displayTextBoxCopy()">
      Display Text
    </button>

    <div id="insert"></div>
    <div id="xAndY"></div>
    <textarea title="Text Box" rows= 10 id="mytext" cols= 10> </textarea>

    <!--classe-->
    <script src="cursorMovement.js"></script>
    <script src="customBox.js"></script>
    <script src="return.js"></script>
    <script src="insertion.js"></script>
    
    <script>
      let gLastLine = 0
      //instantiate the classes
      const CursorMovements = new CursorMovementsClass()
      const Return = new ReturnClass()
      const Insert = new InsertClass()

      //width of canvas, amount of characters, multiplied by five for displaying grid
      const WIDTH = 10
      const HEIGHT = 10

      //Used for changing two dim array into something flat
      let oneDimArray = []

      let blanks = []


      ////////////////////////////////////



      // ELIMINATE ALL CONSOLE LOGS AND ALERTS AND USE :  alert(nestedArray.join('\n'))  and  alert(nestedArray2.join('\n')) THROUGHOUT CODE TO FIND WHERE THE TWO ARRAYS ARE CHANGING INCORRECTLY 
      // THIS LOOKS CRAZY TO ME, I CLOSED ANOTHER INDEX1.HTML, NOT SURE OF EFFECT.  IT IS ALSO ON LARGE DISPLAY, ONLY THIS FILE.





      ///////////////////////////////////////


      //needed delete character on left end with string - very difficult must wrap with top string

      //turn to a one dimensional array and check if there is any space to attach  - remove nulls and turn to a two dimension array
      //needed delete right position with a string

      //check if word fits on line

      //CONSIDERATION THAT CURSOR MAY NEED TO DELETE FROM THE CHARACTER TO RIGHT

      function deleteIt() {
       

          //Readies array to be held completely, next segment below.
          for (let y = 0; y < HEIGHT; y++) {
            for (let x = 0; x < WIDTH; x++) {
             nestedArray2[y][x] = nestedArray[y][x]
            }
          }

          let breakflag = false;
          let counterToSpace = 0;
            for (let y = ((verticalCursorPosition / 10)); y < HEIGHT; y++) {
            for (let x = horizontalCursorPosition/5;  x< WIDTH; x++) {
              counterToSpace++;
            console.log("na1 ", nestedArray);
            console.log("na2 ", nestedArray2);
            
            //nestedArray2[verticalCursorPosition / 10][x] = nestedArray[verticalCursorPosition / 10][x+1]

            if(nestedArray2[y][x] == " ")
            {
              breakflag = true;
              break
            }

          }

            if(breakflag){
              break;
            }
          }

          let counter = 0;
          let breakflag2 = false;

          //is a space
          if (breakflag){

            alert("space");
          for (let y = ((verticalCursorPosition / 10)); y < HEIGHT; y++) {
            for (let x = horizontalCursorPosition/5;  x< WIDTH - 1; x++) {
           counter++;

           if(verticalCursorPosition/10 == HEIGHT-1 && horizontalCursorPosition/5 == WIDTH-1)
           {
            break;
           }


           nestedArray2[y][x] = nestedArray[y][x+1]


           if (counter == counterToSpace-1){
            breakflag2;
            break;
           }
            }

            if(breakflag2){
              break;
            }
          }
        
        


          //horizontalCursorPosition = horizontalCursorPosition - 5;

          //Variable is ready for transfer to other array
          for (let y = 0; y < HEIGHT; y++) {
            for (let x = 0; x < WIDTH; x++) {
              nestedArray[y][x] = nestedArray2[y][x]
            }
          }

          drawGrid()

          CursorMovements.drawCursor(
            horizontalCursorPosition + HOFFSET,
            verticalCursorPosition + VOFFSET
          )
        }
      }

      //vertical and horizontal offset of canvas
      const VOFFSET = 25
      const HOFFSET = 30

      //nestedarray holds values with an array - 35 by 35
      var canvas = document.getElementById('canvas_id')
      //insert is on or off
      var insertOn = document.getElementById('insert')

      let textBox = [[]]

      //rows and columns of canvas
      let rows = WIDTH
      let cols = HEIGHT

      //this is so that the canvas will look okay on a big display
      let ctx = canvas.getContext('2d')
      // Set display size (css pixels).
      //get width of canvasvar size = 300;
      var size = 220
      canvas.style.width = size + 'px'
      canvas.style.height = size + 'px'

      // Set actual size in memory (scaled to account for extra pixel density).
      var scale = window.devicePixelRatio // Change to 1 on retina screens to see blurry canvas.
      canvas.width = size * scale
      canvas.height = size * scale

      // Normalize coordinate system to use css pixels.
      ctx.scale(scale, scale)

      ctx.fillStyle = '#ffffff'
      ctx.fillRect(0, 0, 800, 800)
      ctx.fillStyle = '#000000'
      ctx.font = '3px Monospace'
      ctx.textAlign = 'center'
      ctx.textBaseline = 'middle'

      var x = size / 2
      var y = size / 2

      //fill array wiht no values - set up the two dimensional array
      const nestedArray = Array.from({ length: HEIGHT }, () =>
        Array.from({ length: WIDTH }, () => ' ')
      )

      let nestedArray2 = Array.from({ length: HEIGHT }, () =>
        Array.from({ length: WIDTH }, () => ' ')
      )


      let nestedArray3 = Array.from({ length: HEIGHT }, () =>
        Array.from({ length: WIDTH }, () => ' ')
      )


      rows = 1
      cols = WIDTH
      let = holdsTextToKeep = Array.from({ length: rows }, () =>
        Array.from({ length: cols }, () => 'Y')
      )

      let = holdsTextToMove = Array.from({ length: rows }, () =>
        Array.from({ length: cols }, () => 'C')
      )

      insertOn.innerHTML = 'Insert Off'

      function clearArray() {
        ctx.clearRect(0, 0, 100, 100)
        ctx.fillStyle = '#ffffff'
        ctx.fillRect(0, 0, canvas.width, canvas.height)
        ctx.fillStyle = '#000000'
      }

      function drawGrid() {
        //cols
        clearArray()
        ctx.fillStyle = 'black'
        //columns
        for (let i = 0; i < HEIGHT; i++) {
          //rows
          for (let j = 0; j < WIDTH; j++) {
            //fill a square canvas with letter values
            ctx.fillText(nestedArray[i][j], j * 5 + 25, i * 10 + 25)
          }
        }

        return 1
      }

      //deletes a character without pulling all the values
      function backspaceFormerCharacter() {
        //  change current cursor space to blank
        //  change previous character with under score

        nestedArray[horizontalCursorPosition / 5][verticalCursorPosition / 10] =
          ' '
        horizontalCursorPosition = horizontalCursorPosition - 5

        drawGrid()
        CursorMovements.drawCursor(
          horizontalCursorPosition + HOFFSET,
          verticalCursorPosition + VOFFSET
        )
      }

      //the array of the grid as one dimensional.

      let flag = false

      

      

      let a = 0
      //let z = -1

      ////////

      //second function for inserting, changes one dimenensional array into two dimensions

      //doesn't draw grid and cursor
      function makeTwoDimArray() {

        let z = 0;
        
        //rows
        for (let i = 0; i < HEIGHT; i = i + 1) {
          //columns

          for (j = 0; j < WIDTH; j = j + 1, z++) {
            //set array with characters
            nestedArray[i][j] = oneDimArray[z]
          }
        }
        
      }

      ////////

      //second function for inserting, changes one dimenensional array into two dimensions
      //draws grid
      //draws cursor

      

      let horizontalCursorPosition = 0
      let verticalCursorPosition = 0

      let gKey = ''
      let gInsert = false

      gLastLine = 0

      //if not a special key, come here and display character
      function printCharacter() {
        ctx.clearRect(0, 0, 300, 300)

        console.log('v ', verticalCursorPosition)
        console.log('h ', horizontalCursorPosition)

        //try setting nested array for drawgrid with key press

        nestedArray[verticalCursorPosition / 10][horizontalCursorPosition / 5] =
          gKey

        drawGrid()

        //At edge of canavs - use for edge cases, later.
        //bookmark
        if (horizontalCursorPosition < (WIDTH - 1) * 5) {
          horizontalCursorPosition = horizontalCursorPosition + 5
        }
        CursorMovements.drawCursor(
          horizontalCursorPosition + HOFFSET,
          verticalCursorPosition + VOFFSET
        )
      }

      document.addEventListener('keydown', function (e) {
        //global variable
        gKey = e.key
        customBox1.controlInput()
      })

      //display helpful data
      xAndY.innerHTML =
        'X: ' +
        0 +
        '  &nbsp&nbsp&nbsp   Y: ' +
        0 

      const customBox1 = new CustomBoxClass()

      window.addEventListener("keydown", function(e) {
    if(["Space","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].indexOf(e.code) > -1) {
        e.preventDefault();
    }
  }
      )

    </script>
  </body>
</html>
